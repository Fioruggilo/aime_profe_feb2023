<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Asistencia</title>
  </head>
  <body>
    <h1 class="text-2xl">Asistencia del dia</h1>

    <label for="fecha">Fecha</label>
    <input type="date" id="fecha" class="calendar" />
    <a href="/" class="btn">Seleccionar</a>

    <table class="table-auto">
      <thead>
        <tr>
          <th>APELLIDO</th>
          <th>NOMBRE</th>
          <th>GRADO</th>
          <th>PRESENCIA</th>
          <th>JUSTIFICATIVO</th>
          <th>FECHA</th>
        </tr>
      </thead>
      <tbody>
        {% for asistencia in asistencias %}
        <tr>
          <td>{{ asistencia.apellido }}</td>
          <td>{{ asistencia.nombre }}</td>
          <td>{{ asistencia.grado }}</td>
          <!-- if asistencia.asistencia = 1 then the checkbox is gonna be inicially checked -->
          <td>
            <input type="checkbox" value="{{ asistencia.asistencia }}" {% if
            asistencia.asistencia == 1 %} checked {% endif %}
            onclick="changeState(this)" />
          </td>
          <td>{{ asistencia.justificativo }}</td>
          <td>{{ asistencia.fecha }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </body>

  <!-- Script javascript -->
  <script>
    // changes the value of the checkbox
    function changeState(element) {
      // console.log(element.value);
      // if the value is 1, then it is checked
      if (element.value == 1) {
        element.value = 0;
        checked = false;
        // if the value is 0, then it is unchecked
      } else {
        element.value = 1;
        checked = true;
      }
    }

    // add current date as default to the input date field
    const today = new Date();
    const dd = String(today.getDate()).padStart(2, "0");
    const mm = String(today.getMonth() + 1).padStart(2, "0"); //January is 0!
    const yyyy = today.getFullYear();

    today = dd + "-" + mm + "-" + yyyy;
    document.getElementById("fecha").value = today;

    // parse the date from the calendar
    const btn = document.querySelector(".btn");
    const calendar = document.querySelector(".calendar");

    btn.addEventListener("click", () => {
      const dateArray = calendar.value.split("-");
      const dateParsed = dateArray
        .splice(0, 3, dateArray[2], dateArray[1], dateArray[0])
        .join("-");

      if (btn.getAttribute("href") == "/") {
        btn.setAttribute("href", "/asistencias/" + dateParsed);
      } else {
        btn.setAttribute("href", btn.getAttribute("href") + dateParsed);
      }
    });
  </script>
</html>
